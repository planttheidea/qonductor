!(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("waddup")):"function"==typeof define&&define.amd?define("Qonductor",["waddup"],e):"object"==typeof exports?exports.Qonductor=e(require("waddup")):t.Qonductor=e(t.waddup)})(window,(function(t){return (function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)})([(function(t,e,n){"use strict";e.__esModule=!0;e.DEFAULTS={autoStart:!0,keepHistory:!0,maxConcurrency:10,type:"fifo"},e.STATUSES={CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",FAILED:"FAILED",PENDING:"PENDING",RUNNING:"RUNNING"},e.TYPES={FIFO:"fifo",LIFO:"lifo",SIRO:"siro"}}),(function(t,e,n){t.exports=n(2)}),(function(t,e,n){"use strict";e.__esModule=!0;var r,o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=n(3),u=(r=i)&&r.__esModule?r:{default:r},s=n(0),c=n(8);var a=Math.floor,f=Math.max,l=Math.min,p=Math.random,d=Object.keys,h=(function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.completed={},this.completedCount=0,this.currentIndex=0,this.isRunning=!1,this.pending={},this.pendingCount=0,this.queue={},this.running={},this.runningCount=0;var r=o({},(0,c.getDefaults)(),n),i=r.type,u=(function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n})(r,["type"]);d(u).forEach((function(t){e[t]=u[t]})),this.type=i.toLowerCase()}return t.prototype._addQueueItemCancel=function(t){return function(e){t.status!==s.STATUSES.PENDING&&t.status!==s.STATUSES.RUNNING||t._publishCancellation(e)}},t.prototype._complete=function(t,e){if(this.completed[t]||(this.keepHistory&&(this.completed[t]=e),this.completedCount++),this.running[t]?(delete this.running[t],this.runningCount--):this.pending[t]&&(delete this.pending[t],this.pendingCount--),delete this.queue[t],this.isRunning&&this.pendingCount)return this._runQueue();this.runningCount||this.pendingCount||(this.isRunning=!1)},t.prototype._getNextIndex=function(t,e){if(!t.length)return-1;switch(e){case s.TYPES.LIFO:return f.apply(void 0,t);case s.TYPES.SIRO:return t[a(p()*t.length)];default:return l.apply(void 0,t)}},t.prototype._runQueue=function(){for(var t=this.runningCount;++t<=this.maxConcurrency;){var e=this._getNextIndex(d(this.pending),this.type);if(-1===e)break;var n=this.pending[e];this.running[e]=n,this.runningCount++,delete this.pending[e],this.pendingCount--,n.run()}},t.setDefaults=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t||t.constructor!==Object)throw new SyntaxError("Defaults assignment must be passed an object.");return(0,c.setDefaults)(t)},t.prototype.add=function(t,e){var n=this.currentIndex,r="function"==typeof t?n:t,o=e||t,i=new u.default(r,o,this._complete.bind(this));return this.queue[n]=i,this.currentIndex++,this.pending[n]=i,this.pendingCount++,i.promise.cancel=this._addQueueItemCancel(i),this.autoStart&&!this.isRunning&&this.start(),i.promise},t.prototype.clear=function(){var t=this;Object.keys(this.queue).forEach((function(e){t.queue[e].status!==s.STATUSES.COMPLETED&&t.queue[e].promise.cancel()}))},t.prototype.start=function(){this.isRunning||(this.isRunning=!0,this._runQueue())},t.prototype.stop=function(){this.isRunning=!1},t})();h.getDefaults=c.getDefaults,h.resetDefaults=c.resetDefaults,e.default=h}),(function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(4),i=n(5),u=(r=i)&&r.__esModule?r:{default:r},s=n(0),c=n(7);var a=(function(){function t(e,n,r){!(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.cancelId=null,this.isCancelled=!1,this.promiseId=null,this.status=s.STATUSES.PENDING,this.id=e,this.promise=this._createPromiseWrapper(n,(0,c.getOnSuccess)(this,r),(0,c.getOnFail)(this,r))}return t.prototype._cancelPromise=function(t,e){this.status=s.STATUSES.CANCELLED,t(new u.default(e,s.STATUSES.CANCELLED))},t.prototype._createPromiseWrapper=function(t,e,n){var r=this,i="function"==typeof t?t:function(e){return e(t)};return new Promise(function(t,e){var n=(0,c.getDone)(r._resolvePromise(t),r._rejectPromise(e));r.cancelId=(0,o.subscribe)(s.STATUSES.CANCELLED,(function(t){var n=t.data;n.id===r.id&&(r.isCancelled=!0,r._cancelPromise(e,n.message))})),r.promiseId=(0,o.subscribe)(s.STATUSES.RUNNING,(function(t){t.data.id===r.id&&(i(n),(0,o.unsubscribe)(r.promiseId))}))}).then(this._getUnsubscribeOnResolve()).catch(this._getUnsubscribeOnReject()).then(e).catch(n)},t.prototype._getUnsubscribeOnReject=function(){var t=this;return function(e){return(0,o.unsubscribe)(t.cancelId),Promise.reject(e)}},t.prototype._getUnsubscribeOnResolve=function(){var t=this;return function(e){return(0,o.unsubscribe)(t.cancelId),e}},t.prototype._publishCancellation=function(t){(0,o.publish)(s.STATUSES.CANCELLED,{id:this.id,message:t})},t.prototype._rejectPromise=function(t){var e=this;return function(n){e.isCancelled||(e.status=s.STATUSES.FAILED,t(new u.default(n)))}},t.prototype._resolvePromise=function(t){var e=this;return function(n){e.isCancelled||(e.status=s.STATUSES.COMPLETED,t(n))}},t.prototype.run=function(){this.status=s.STATUSES.RUNNING,(0,o.publish)(s.STATUSES.RUNNING,{id:this.id,message:this.id+" resolved successfully."})},t})();e.default=a}),(function(e,n){e.exports=t}),(function(t,e,n){"use strict";e.__esModule=!0;var r,o=n(6),i=(r=o)&&r.__esModule?r:{default:r},u=n(0);var s=(function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.STATUSES.FAILED;return (function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),(function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e})(this,t.call(this,"Queue promise was rejected with status "+r+(n?": "+n+".":".")))}return (function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)})(e,t),e})(i.default);e.default=s}),(function(t,e,n){"use strict";e.__esModule=!0;var r=(function(t){function e(n){!(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e);var r=(function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e})(this,t.call(this));return Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,r.constructor):Object.defineProperty(r,"stack",{value:(new Error).stack}),Object.defineProperty(r,"message",{value:n}),r}return (function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)})(e,t),e})(Error);e.default=r}),(function(t,e,n){"use strict";e.__esModule=!0;e.getDone=function(t,e){return function(n,r){return r?e(r):t(n)}},e.getOnFail=function(t,e){return function(n){return e(t.id,t),Promise.reject(n)}},e.getOnSuccess=function(t,e){return function(n){return e(t.id,t),n}}}),(function(t,e,n){"use strict";e.__esModule=!0,e.setDefaults=e.resetDefaults=e.getDefaults=e.currentDefaults=void 0;var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=n(0),i=Object.keys,u=e.currentDefaults=r({},o.DEFAULTS);e.getDefaults=function(){return u},e.resetDefaults=function(){return e.currentDefaults=u=r({},o.DEFAULTS)},e.setDefaults=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(t).reduce((function(e,n){return o.DEFAULTS.hasOwnProperty(n)&&(e[n]=t[n]),e}),u)}})])}));